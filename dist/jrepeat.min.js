!function(I){"use strict";function s(e,t){switch(typeof e){case"object":return JSON.stringify(e);case"undefined":return t?"":"undefined";case"string":return t?e:JSON.stringify(e);default:return e.toString()}}function h(t,e,n,a){if(t){n=n||{},a=a||{};var r={};for(var i in r.$self=e,n)r["$"+i]=n[i];for(var o,d={sandbox:void 0},s=/([\w]+)\s*(\()?/g;o=s.exec(t);)o[2]?d[o[1]]=function(){}:d[o[1]]=void 0;var c,u=I.extend(d,"object"==typeof e?e:{},r,a),f=l("expression",t);(c=p(f))||(c=p(f,Function("sandbox","with (sandbox) {return ("+t+")}")));try{return c(u)}catch(e){return console.error(t),void console.error(e)}}}function l(){var e="";for(var t in arguments)e+="#"+s(arguments[t]).replace(/#/g,"##");var n=0;if(0===e.length)return n;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}function p(e,t,n){if(p.memory[n=n||"general"]=p.memory[n]||{},e)return t&&(p.memory[n][e]=t),p.memory[n][e];delete p.memory[n]}p.memory={},I.fn.jRepeat=function(e){var y,r,a,i;if(e=e||{},this.data("jrepeat")){for(var t in y=this.data("jrepeat"),e)y.prop(t,e[t]);return y}y={filter:function(e){return r=e,E("page",0),w=!0,y},sort:function(e){return a=e,w=!0,y},reset:function(){return r=function(){return!0},a=null,E("page",0),w=!0,y},nextPage:function(){return y.setPage(E("page")+1)},prevPage:function(){return y.setPage(E("page")-1)},setPage:function(e){if(E("page"),E("limit")){var t=Math.floor((M().length-1)/E("limit"));E("page",e<=t?0<=e?e:0:t)}else E("page",0);return y},length:function(){return M().length},render:function(e){return function(t){t=w=w||t,T&&(clearTimeout(j),T());var e=M();E("limit")&&(e=e.slice(E("page")*E("limit"),(E("page")+1)*E("limit")));for(var n=E("page")*E("limit"),a=E("container").data("contents")||[],r=E("container").data("ids")||[],i=[],o=[],d=[],s=[],c=0;c<e.length;c++){var u=n+c,f=O(u),l=f.data("jid"),p=r.indexOf(l);~p?a[p].data("hash")!==f.data("hash")?(a[p].replaceWith(f),a[p]=f):f=a[p]:(f.addClass("jrepeat-add"),d.push(f)),i.push(f),f.data("i",c),f.data("globalIndex",H[u]),o.push(l)}for(var v,h=0,g=0;h<a.length||g<i.length;){var m;a[h]?i[g]?a[h]===i[g]?(m=i[g++],h++):m=a[h].data("globalIndex")<i[g].data("globalIndex")?a[h++]:i[g++]:m=a[h++]:m=i[g++],~d.indexOf(m)&&s.push(v),v=m}var x=[];for(var c in r)~o.indexOf(r[c])||(a[c].addClass("jrepeat-remove"),x.push(a[c]));var C=!1;T=function(){if(!C){if(C=!0,t||x.length===a.length)E("container").html(function e(t){for(var n=document.createDocumentFragment(),a=0;a<t.length;a++)t[a]instanceof Node?n.append(t[a]):"object"==typeof t[a]&&n.append(e(t[a]));return n}(i));else{for(var e in d)s[e]?s[e].after(d[e]):0===e?E("container").prepend(d[e]):E("container").append(d[e]);x.map(function(e){b[l]=e.detach().removeClass("jrepeat-remove")})}E("container").data("contents",i),E("container").data("ids",o),j=T=null,(E("onUpdateCallback")||function(){})(L(d),y),setTimeout(function(){I(L(d)).removeClass("jrepeat-add")},E("transitionEnter"))}},x.length&&E("transitionExit")?j=setTimeout(T,E("transitionExit")):T()}(e),y},tpl:c};var j,T,w=!0;function M(){if(!E("state"))throw new Error("No state specified");var e,t,n;return w&&(e=E("state"),H=[],t=e.filter(function(e,t,n){var a=!r||r(e,t,n);return a&&H.push(t),a}),n=(n=t).map(function(e,t){return{item:e,gi:H[t]}}),n=a?n.sort(function(e,t){return a(e.item,t.item)||e.gi-t.gi}):n.sort(function(e,t){return e.gi-t.gi}),H=[],i=n=n.map(function(e,t){return H.push(e.gi),e.item}),w=!1),i}y=I.extend(this.jTemplate(e,{transitionExit:0,transitionEnter:0,limit:0,page:0,tag:void 0,trackBy:void 0}),y),this.data("jrepeat",y);var b={},H=[];function L(e){for(var t=[],n=0;n<e.length;n++)e[n]instanceof jQuery?t=t.concat(L(e[n])):t.push(e[n]);return t}function O(e,t){var n,a,r,i,o=(n=e,(a=E("trackBy"))?h(a,M()[n],{index:n},E("functions")):"$index="+H[n]),d=c(),s=l(d,M()[e],{index:e},E("functions"));return b[o]&&b[o].data("hash")===s||(b[o]=I((r=u(d,M()[e],{index:e},E("functions")),(i=document.createElement("div")).innerHTML=r,i.children)),b[o].data("hash",s),b[o].data("jid",o)),b[o].data("index",e),b[o]}function c(e){var t=void 0;return e&&E("template",e),!t&&E("templateId")&&(t=(I("#"+CSS.escape(E("templateId")))[0]||{}).innerHTML),!t&&E("tag")&&(t="<"+escape(E("tag"))+">{{$self}}</"+escape(E("tag"))+">"),!t&&E("template")&&(t=E("template")),t||(t=E("initialContent")),t}var E=y.prop,u=y.templateRenderer;return E("template",c()),y},I.fn.jTemplate=function(e,a){var n;function t(e){e&&r("template",e);var t=r("templateId");return r("template")?r("template"):t?(I("#"+CSS.escape(t))[0]||{}).innerHTML:r("initialContent")}function v(e,i,o,d){var t=l("template",e,i,o,d),n=p(t);return n||p(t,e=(e=function(e,f,l,p){var t=I("<div></div>");function n(e,t){for(var n=0;n<e.length;n++)t(n,e[n])}return t[0].innerHTML=e,n(t.find("[data-if]").not(t.find("[data-each] [data-if]")),function(e,t){var n=I(t),a=n[0].dataset.if;(a?h(a,f,l,p):void 0)||n.remove()}),n(t.find("[data-show]").not(t.find("[data-each] [data-show]")),function(e,t){var n=I(t),a=n[0].dataset.show,r=a?h(a,f,l,p):void 0;n.addClass(r?"show":"hide"),n.removeClass(r?"hide":"show")}),n(t.find("[data-class]").not(t.find("[data-each] [data-class]")),function(e,t){var n=I(t),a=n[0].dataset.class,r=a?h(a,f,l,p):void 0;for(theClass in r)r[theClass]?n.addClass(theClass):n.removeClass(theClass)}),n(t.find("[data-each]").not(t.find("[data-each] [data-each]")),function(e,t){var n=I(t),a=t.innerHTML,r="",i=n[0].dataset.each,o=i?h(i,f,l,p):void 0;if(o){var d=I.extend({},l),s=0;for(var c in d)0==c.indexOf("index")&&s++;for(var u in o)d["index"+(s||"")]=u,r+=v(a,f,d,p)}t.innerHTML=r}),t[0].innerHTML}(e,i,o,d)).replace(/({{(.*?)}})/g,function(e,t,n,a,r){return s(h(n,i,o,d),!0).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}))}function r(e,t){return void 0===t?a.hasOwnProperty(e)?n.data[e]=function(e){if("string"!=typeof e)return e;var t=l(e);if(p(t,null,"parse"))return p(t,null,"parse");var n=e;if(e.length)if("undefined"==e)n=void 0;else try{n=JSON.parse(e)}catch(e){}else n=void 0;return p(t,n,"parse"),n}(n.data.container[0].dataset[e]):n.data[e]:(n.data[e]=t,a.hasOwnProperty(e)&&(n.data.container[0].dataset[e]=s(t,!0)),t)}return(e=e||{}).functions=e.functions||{},(a=a||{}).templateId=a.templateId||void 0,(n={render:function(){return function(){if(!r("state"))throw new Error("No state specified");r("container").addClass("jrepeat-processed");var e=I("<div></div>");e.append(v(t(),r("state"),{},r("functions"))),e[0].innerHTML!==r("container")[0].innerHTML&&(r("container")[0].innerHTML=e[0].innerHTML,(r("onUpdateCallback")||function(){})(r("container"),n))}(),n},onUpdate:function(e){return r("onUpdateCallback",e),n},set:function(e,t){return r(e,t),n},get:function(e){return r(e)},prop:r,templateRenderer:v,tpl:t}).data=I.extend({},a,function(e){var t={};for(var n in a)t[n]=e[0].dataset[n];return t}(this),e,{container:this,initialContent:this[0].innerHTML}),function(){for(var e in a)r(e,n.data[e])}(),n}}(jQuery);